<!--
  Generated template for the LoginPage page.

  See http://ionicframework.com/docs/v2/components/#navigation for more info on
  Ionic pages and navigation.
-->


  <ion-content class="login" *ngIf="!isAuthorized">

      <div padding>
        <ion-segment [(ngModel)]="authType">
          <ion-segment-button value="login">
            Login
          </ion-segment-button>
          <ion-segment-button value="signup">
            Signup
          </ion-segment-button>
        </ion-segment>
      </div>

      <div [ngSwitch]="authType">
        <form *ngSwitchWhen="'login'" [ngFormModel]="loginForm" (ngSubmit)="login(loginForm.value)">
          <ion-item *ngIf="isLoginIncorrect " >
            <p  class="invalid">Login informations are incorrect</p>
          </ion-item>
          <ion-item>
            <ion-label>Mail</ion-label>
            <ion-input type="text" ngControl="email"></ion-input>
          </ion-item>

          <ion-item>
            <ion-label>Password</ion-label>
            <ion-input type="password" ngControl="password"></ion-input>
          </ion-item>

          <div padding>
            <button block type="submit">Login</button>        
          </div>

        </form>

        <form *ngSwitchWhen="'signup'"  [ngFormModel]="signupForm" (ngSubmit)="signup(signupForm.value)">
          <ion-item>
            <ion-label floating>Gender</ion-label>
            <ion-select [(ngFormControl)]="signupForm.controls['sex']" >
              <ion-option value="f" >Female</ion-option>
              <ion-option value="m" >Male</ion-option>
            </ion-select>
          </ion-item>

          <ion-item>
            <ion-label floating>Name</ion-label>
            <ion-input type="text"  [ngFormControl]="signupForm.controls['name']"></ion-input>
          </ion-item>
          <ion-item *ngIf="!signupForm.controls.name.valid  && (submitAttempt || signupForm.controls.name.touched)" >
            <p  class="invalid">Please enter a valid name.</p>
          </ion-item>

          <ion-item>
            <ion-label floating>LastName</ion-label>
            <ion-input type="text"  [ngFormControl]="signupForm.controls['lastName']"></ion-input>
          </ion-item>
          <ion-item *ngIf="!signupForm.controls.lastName.valid  && (submitAttempt || signupForm.controls.lastName.touched)" >
            <p class="invalid">Please enter a valid lastName.</p>
          </ion-item>

          <ion-item>
            <ion-label floating>Mail</ion-label>
            <ion-input type="email"  [ngFormControl]="signupForm.controls['email']"></ion-input>
          </ion-item>
          <ion-item *ngIf="!signupForm.controls.email.valid  && (submitAttempt || signupForm.controls.email.touched)"  >
            <p class="invalid">Please enter a valid mail.</p>
          </ion-item>

          <ion-item>
            <ion-label floating>Password</ion-label>
            <ion-input type="password"  [ngFormControl]="signupForm.controls['password']"></ion-input>
          </ion-item>
          <ion-item *ngIf="!signupForm.controls.password.valid  && (submitAttempt || signupForm.controls.password.touched)"  >
            <p class="invalid">Please enter a valid password.</p>
          </ion-item>

         
          <ion-item>
            <ion-label floating>School Name</ion-label>
            <ion-input type="text"  [ngFormControl]="signupForm.controls['school']"></ion-input>
          </ion-item>
          <ion-item *ngIf="!signupForm.controls.school.valid  && (submitAttempt || signupForm.controls.school.touched)"  >
            <p class="invalid">Please enter a valid school.</p>
          </ion-item>

           <ion-item>
            <ion-label floating>City Name</ion-label>
            <ion-input type="text"  [ngFormControl]="signupForm.controls['city']"></ion-input>
          </ion-item>
          <ion-item *ngIf="!signupForm.controls.city.valid  && (submitAttempt || signupForm.controls.city.touched)"  >
            <p class="invalid">Please enter a valid city.</p>
          </ion-item>

          <ion-item>
            <ion-label floating class="toto">Date of birth</ion-label>
            <ion-datetime displayFormat="DD MMM YYYY"  [ngFormControl]="signupForm.controls['dob']"></ion-datetime>
          </ion-item>
          <ion-item *ngIf="!signupForm.controls.dob.valid  && (submitAttempt || signupForm.controls.dob.touched)"  >
            <p class="invalid">Please enter a valid dob.</p>
          </ion-item>


          <div padding>
            <button block type="submit">Signup</button>
          </div>

        </form>
      </div>

      <div padding>
        <p *ngIf="error" class="error">{{ error._body }}</p>  
      </div>

  </ion-content>

  <ion-content *ngIf="isAuthorized">
      <div padding>
        <h1>Welcome, {{ user.name }}</h1>
        <button block (click)="logout()">Logout</button>
      </div>  
  </ion-content>